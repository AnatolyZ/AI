<!DOCTYPE html>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="icon" type="image/png" href="img/icon.png" />
  <script>
	var AI_data = {
		addr_IP: "192.168.4.253",
		mask: "255.255.255.000",
		gate: "192.168.4.1",
		port: 102,
		speed: 187500,
		addr_own: 0,
		ver: "0.0.0",
		sn: 0,
		addr_MAC: "AA-BB-CC-DD-EE-FF",
	}
    var xhr1;
	function onload(){		
		xhr1 = new(XMLHttpRequest);
		xhr1.open("GET", "AI.data?=" + Math.random(), true);
		xhr1.responseType = "text";
		xhr1.onload = function (oEvent) {
			var resp = xhr1.response;
			AI_data = JSON.parse (resp);
			document.getElementById('IP_addr').value = AI_data.addr_IP;
			document.getElementById('Subnet_addr').value = AI_data.mask;
			document.getElementById('Gateway').value = AI_data.gate;
			document.getElementById('Port_num').value = AI_data.port;
			document.getElementById('Speed').value = AI_data.speed;
			document.getElementById('Addr_own').value = AI_data.addr_own;
			document.getElementById('Addr_MAC').value = AI_data.addr_MAC;
			document.getElementById('Serial').value = AI_data.sn;
			document.getElementById('Version').innerHTML = AI_data.ver;
		}
		xhr1.send(null);					
	}
	var xhr2;
	function button_click()	
	{
		if (confirm("Все внесенные изменения будут применены после перезагрузки устройства. На данный момент проверка коректности введенных данных не реализована. БУДТЕ ВНИМАТЕЛЬНЫ!!!"))
		{
			AI_data.addr_IP = document.getElementById('IP_addr').value;
			AI_data.mask = document.getElementById('Subnet_addr').value;
			AI_data.gate = document.getElementById('Gateway').value;
			AI_data.port = document.getElementById('Port_num').value;
			AI_data.speed = document.getElementById('Speed').value;
			AI_data.addr_own = document.getElementById('Addr_own').value;			
			AI_data.addr_MAC = document.getElementById('Addr_MAC').value;
			AI_data.sn = document.getElementById('Serial').value;
			xhr2 = new(XMLHttpRequest);
			xhr2.open("GET", "json=" + JSON.stringify(AI_data) + Math.random(), true);
			xhr2.responseType = "text";
			xhr2.onload = function (oEvent) {
				alert("Данные успешно переданы на устройство.");
			}
			xhr2.send(null);
		}
	}
	var xhr3;
	function reboot_click()	
	{
		xhr3 = new(XMLHttpRequest);
		xhr3.open("GET", "cmd.reboot=1"+ Math.random(), true);
		xhr3.responseType = "text";
		xhr3.onload = function (oEvent) {
			alert("Выполнена перзагрузка устройства.");
			onload();
		}
		xhr3.send(null);
	}
  </script>
  <link rel="stylesheet" href="style.css">
  <title>Адаптер интерфейсов АИ-01</title>
 </head>
	<body onload = "onload()">
		<div id = "header" >
			<p align = "center">
				<img src="img/logo.png" alt = "dispetcher_logo">
			</p>
			<p align = "center" >
				Настройка параметров адаптера интерфейсов АИ-01
			</p>
		</div>
		<div id = "page" >		
			<table border="1" width="35%"  cellpadding="5" align="center">
				<tr>
					<th>Параметр</th>
					<th>Значение</th>
				</tr>		
				<tr>
					<td>IP-адрес</td>
					<td align = "center" ><input id = "IP_addr" type="text"></td>
					</td>
				</tr>		
				<tr>
					<td>Маска подсети</td>
					<td align = "center" ><input id = "Subnet_addr" type="text"></td>
					</td>
				</tr>		
				<tr>
					<td>Шлюз</td>
					<td align = "center" ><input id = "Gateway" type="text"></td>
					</td>
				</tr>		
				<tr>
					<td>Номер порта</td>
					<td align = "center" ><input id = "Port_num" type="text"></td>
					</td>
				</tr>					
				<tr>
					<td>Скорость обмена, Бод</td>
					<td align = "center" ><input id = "Speed" type="text"></td>
				</tr>						
				<tr>
					<td>Адрес преобразователя</td>
					<td align = "center" ><input id = "Addr_own" type="text"></td>
				</tr>				
				<tr>
					<td>MAC-адрес</td>
					<td align = "center" ><input id = "Addr_MAC" type="text"></td>
				</tr>				
				<tr>
					<td>Серийный номер</td>
					<td align = "center" ><input id = "Serial" type="text"></td>
				</tr>
				<tr>
					<td>Версия ВПО</td>
					<td align = "center" id = "Version"></td>
				</tr>
			</table>				
			<div align="center" float = "left" >			
					<input type="button" value = "Сохранить" onclick="button_click()">
					<input type="button" value = "Перезагрузка" onclick="reboot_click()">		
			</div>
		</div>
	</body>
</html>
